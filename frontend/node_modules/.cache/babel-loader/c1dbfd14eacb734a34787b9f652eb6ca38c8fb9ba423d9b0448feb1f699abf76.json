{"ast":null,"code":"import _slicedToArray from \"/home/daniel/go/src/github.com/DanielYevelkin/clutch-custom-gateway/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport * as React from \"react\";\nimport { client } from \"./Network/index\";\nvar FEATURE_FLAG_POLL_RATE = +process.env.REACT_APP_FF_POLL || 300000;\nvar FF_CACHE_TTL = +process.env.REACT_APP_FF_CACHE_TTL || 60000;\nvar featureFlags = function featureFlags() {\n  var cachedFlags = JSON.parse(sessionStorage.getItem(\"featureFlags\"));\n  if (cachedFlags) {\n    var elapsedTime = new Date(new Date().getTime() - cachedFlags.timestamp).getTime();\n    if (elapsedTime < FF_CACHE_TTL) {\n      return new Promise(function (resolve) {\n        resolve(cachedFlags.flags);\n      });\n    }\n  }\n  return client.post(\"/v1/featureflag/getFlags\", {}, {\n    timeout: 1000\n  }).then(function (response) {\n    var flags = response.data.flags;\n    var cache = {\n      timestamp: new Date().getTime(),\n      flags: flags\n    };\n    sessionStorage.setItem(\"featureFlags\", JSON.stringify(cache));\n    return flags;\n  }).catch(function (error) {\n    // TODO: add instrumentation here\n    console.warn(\"failed to fetch flags: \", error); // eslint-disable-line\n    return (cachedFlags === null || cachedFlags === void 0 ? void 0 : cachedFlags.flags) || {};\n  });\n};\n/**\n * A generic simple feature flag component. This exists to mask the feature enabled\n * state as a prop on the exposed On/Off components.\n */\nvar GenericSimpleFeatureFlagState = function GenericSimpleFeatureFlagState(_ref) {\n  var children = _ref.children,\n    enabled = _ref.enabled,\n    expectedState = _ref.expectedState;\n  return React.createElement(React.Fragment, null, enabled === expectedState && children);\n};\nvar FeatureOn = function FeatureOn(_ref2) {\n  var children = _ref2.children;\n  return React.createElement(React.Fragment, null, children);\n};\nvar FeatureOff = function FeatureOff(_ref3) {\n  var children = _ref3.children;\n  return React.createElement(React.Fragment, null, children);\n};\n/**\n * A feature flag wrapper that evaluates a binary value of a specified flag to determine\n * if it's children should be shown.\n */\nvar SimpleFeatureFlag = function SimpleFeatureFlag(_ref4) {\n  var feature = _ref4.feature,\n    children = _ref4.children;\n  var cachedFlags = JSON.parse(sessionStorage.getItem(\"featureFlags\"));\n  var _React$useState = React.useState((cachedFlags === null || cachedFlags === void 0 ? void 0 : cachedFlags.flags) || {}),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    flags = _React$useState2[0],\n    setFlags = _React$useState2[1];\n  var _React$useState3 = React.useState(false),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    featureEnabled = _React$useState4[0],\n    setFeatureEnabled = _React$useState4[1];\n  var loadFlags = function loadFlags() {\n    featureFlags().then(function (f) {\n      return setFlags(f);\n    });\n  };\n  React.useEffect(function () {\n    loadFlags();\n    var interval = setInterval(loadFlags, FEATURE_FLAG_POLL_RATE);\n    return function () {\n      return clearInterval(interval);\n    };\n  }, []);\n  React.useEffect(function () {\n    var flag = flags === null || flags === void 0 ? void 0 : flags[feature];\n    if (flag !== undefined) {\n      setFeatureEnabled(flag.booleanValue);\n    }\n  }, [flags]);\n  var statefulChildren = React.Children.map(children, function (child) {\n    return React.createElement(GenericSimpleFeatureFlagState, {\n      enabled: featureEnabled,\n      expectedState: child.type === FeatureOn\n    }, child.props.children);\n  });\n  return React.createElement(React.Fragment, null, statefulChildren);\n};\nexport { FEATURE_FLAG_POLL_RATE, featureFlags, FeatureOff, FeatureOn, SimpleFeatureFlag };","map":{"version":3,"names":["React","client","FEATURE_FLAG_POLL_RATE","process","env","REACT_APP_FF_POLL","FF_CACHE_TTL","REACT_APP_FF_CACHE_TTL","featureFlags","cachedFlags","JSON","parse","sessionStorage","getItem","elapsedTime","Date","getTime","timestamp","Promise","resolve","flags","post","timeout","then","response","data","cache","setItem","stringify","catch","error","console","warn","GenericSimpleFeatureFlagState","_ref","children","enabled","expectedState","createElement","Fragment","FeatureOn","_ref2","FeatureOff","_ref3","SimpleFeatureFlag","_ref4","feature","_React$useState","useState","_React$useState2","_slicedToArray","setFlags","_React$useState3","_React$useState4","featureEnabled","setFeatureEnabled","loadFlags","f","useEffect","interval","setInterval","clearInterval","flag","undefined","booleanValue","statefulChildren","Children","map","child","type","props"],"sources":["/home/daniel/go/src/github.com/DanielYevelkin/clutch-custom-gateway/frontend/node_modules/@clutch-sh/core/dist/flags.js"],"sourcesContent":["import * as React from \"react\";\nimport { client } from \"./Network/index\";\nconst FEATURE_FLAG_POLL_RATE = +process.env.REACT_APP_FF_POLL || 300000;\nconst FF_CACHE_TTL = +process.env.REACT_APP_FF_CACHE_TTL || 60000;\nconst featureFlags = () => {\n    const cachedFlags = JSON.parse(sessionStorage.getItem(\"featureFlags\"));\n    if (cachedFlags) {\n        const elapsedTime = new Date(new Date().getTime() - cachedFlags.timestamp).getTime();\n        if (elapsedTime < FF_CACHE_TTL) {\n            return new Promise(resolve => {\n                resolve(cachedFlags.flags);\n            });\n        }\n    }\n    return client\n        .post(\"/v1/featureflag/getFlags\", {}, { timeout: 1000 })\n        .then(response => {\n        const { flags } = response.data;\n        const cache = {\n            timestamp: new Date().getTime(),\n            flags,\n        };\n        sessionStorage.setItem(\"featureFlags\", JSON.stringify(cache));\n        return flags;\n    })\n        .catch((error) => {\n        // TODO: add instrumentation here\n        console.warn(\"failed to fetch flags: \", error); // eslint-disable-line\n        return (cachedFlags === null || cachedFlags === void 0 ? void 0 : cachedFlags.flags) || {};\n    });\n};\n/**\n * A generic simple feature flag component. This exists to mask the feature enabled\n * state as a prop on the exposed On/Off components.\n */\nconst GenericSimpleFeatureFlagState = ({ children, enabled, expectedState, }) => React.createElement(React.Fragment, null, enabled === expectedState && children);\nconst FeatureOn = ({ children }) => React.createElement(React.Fragment, null, children);\nconst FeatureOff = ({ children }) => React.createElement(React.Fragment, null, children);\n/**\n * A feature flag wrapper that evaluates a binary value of a specified flag to determine\n * if it's children should be shown.\n */\nconst SimpleFeatureFlag = ({ feature, children }) => {\n    const cachedFlags = JSON.parse(sessionStorage.getItem(\"featureFlags\"));\n    const [flags, setFlags] = React.useState((cachedFlags === null || cachedFlags === void 0 ? void 0 : cachedFlags.flags) || {});\n    const [featureEnabled, setFeatureEnabled] = React.useState(false);\n    const loadFlags = () => {\n        featureFlags().then(f => setFlags(f));\n    };\n    React.useEffect(() => {\n        loadFlags();\n        const interval = setInterval(loadFlags, FEATURE_FLAG_POLL_RATE);\n        return () => clearInterval(interval);\n    }, []);\n    React.useEffect(() => {\n        const flag = flags === null || flags === void 0 ? void 0 : flags[feature];\n        if (flag !== undefined) {\n            setFeatureEnabled(flag.booleanValue);\n        }\n    }, [flags]);\n    const statefulChildren = React.Children.map(children, child => (React.createElement(GenericSimpleFeatureFlagState, { enabled: featureEnabled, expectedState: child.type === FeatureOn }, child.props.children)));\n    return React.createElement(React.Fragment, null, statefulChildren);\n};\nexport { FEATURE_FLAG_POLL_RATE, featureFlags, FeatureOff, FeatureOn, SimpleFeatureFlag };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}